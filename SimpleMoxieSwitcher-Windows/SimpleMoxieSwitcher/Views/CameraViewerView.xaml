<UserControl x:Class="SimpleMoxieSwitcher.Views.CameraViewerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.Resources>
        <Storyboard x:Key="RecordingPulse">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0.5" To="1" Duration="0:0:1"
                           RepeatBehavior="Forever" AutoReverse="True"/>
        </Storyboard>
    </UserControl.Resources>

    <Grid Background="#0A0A0A">
        <!-- Main Layout -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Top Control Bar -->
            <Border Grid.Row="0"
                    Background="#1A1A1A"
                    BorderBrush="#333333"
                    BorderThickness="0,0,0,1">
                <Grid Height="60">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Camera Selection -->
                    <StackPanel Grid.Column="0"
                              Orientation="Horizontal"
                              Margin="20,0">
                        <TextBlock Text="Camera:"
                                 VerticalAlignment="Center"
                                 Foreground="White"
                                 Margin="0,0,10,0"/>
                        <ComboBox SelectedItem="{Binding SelectedCamera}"
                                ItemsSource="{Binding AvailableCameras}"
                                Width="200"
                                VerticalAlignment="Center">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <ToggleButton Content="ðŸ“· Moxie's View"
                                    IsChecked="{Binding IsMoxieCamera}"
                                    Margin="20,0,0,0"
                                    Padding="10,5"
                                    VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Status Indicator -->
                    <StackPanel Grid.Column="1"
                              Orientation="Horizontal"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center">
                        <Ellipse Width="12"
                               Height="12"
                               Fill="{Binding StatusColor}"
                               Margin="0,0,10,0">
                            <Ellipse.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard Storyboard="{StaticResource RecordingPulse}"/>
                                </EventTrigger>
                            </Ellipse.Triggers>
                        </Ellipse>
                        <TextBlock Text="{Binding StatusText}"
                                 Foreground="White"
                                 FontWeight="SemiBold"/>
                    </StackPanel>

                    <!-- View Options -->
                    <StackPanel Grid.Column="2"
                              Orientation="Horizontal"
                              Margin="20,0">
                        <Button Content="ðŸ”²"
                              ToolTip="Grid Overlay"
                              Command="{Binding ToggleGridCommand}"
                              Width="40"
                              Height="40"
                              Margin="5,0"
                              Background="Transparent"
                              BorderBrush="#666666"
                              Foreground="White"/>

                        <Button Content="ðŸŽ¯"
                              ToolTip="Face Detection"
                              Command="{Binding ToggleFaceDetectionCommand}"
                              Width="40"
                              Height="40"
                              Margin="5,0"
                              Background="{Binding FaceDetectionBackground}"
                              BorderBrush="#666666"
                              Foreground="White"/>

                        <Button Content="â›¶"
                              ToolTip="Fullscreen"
                              Command="{Binding ToggleFullscreenCommand}"
                              Width="40"
                              Height="40"
                              Margin="5,0"
                              Background="Transparent"
                              BorderBrush="#666666"
                              Foreground="White"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Camera Feed Area -->
            <Grid Grid.Row="1"
                  Background="#000000">

                <!-- Video Feed -->
                <Image x:Name="CameraFeed"
                     Source="{Binding VideoSource}"
                     Stretch="Uniform"
                     RenderOptions.BitmapScalingMode="HighQuality"/>

                <!-- Grid Overlay -->
                <Canvas Visibility="{Binding GridOverlayVisibility}">
                    <!-- Horizontal Lines -->
                    <Line X1="0" Y1="{Binding ThirdHeight}"
                        X2="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Canvas}}"
                        Y2="{Binding ThirdHeight}"
                        Stroke="#33FFFFFF" StrokeThickness="1"/>
                    <Line X1="0" Y1="{Binding TwoThirdHeight}"
                        X2="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Canvas}}"
                        Y2="{Binding TwoThirdHeight}"
                        Stroke="#33FFFFFF" StrokeThickness="1"/>

                    <!-- Vertical Lines -->
                    <Line X1="{Binding ThirdWidth}" Y1="0"
                        X2="{Binding ThirdWidth}"
                        Y2="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Canvas}}"
                        Stroke="#33FFFFFF" StrokeThickness="1"/>
                    <Line X1="{Binding TwoThirdWidth}" Y1="0"
                        X2="{Binding TwoThirdWidth}"
                        Y2="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Canvas}}"
                        Stroke="#33FFFFFF" StrokeThickness="1"/>
                </Canvas>

                <!-- Face Detection Overlays -->
                <ItemsControl ItemsSource="{Binding DetectedFaces}"
                            Visibility="{Binding FaceDetectionVisibility}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="#00FF00"
                                  BorderThickness="2"
                                  CornerRadius="5"
                                  Width="{Binding Width}"
                                  Height="{Binding Height}"
                                  Canvas.Left="{Binding X}"
                                  Canvas.Top="{Binding Y}">
                                <TextBlock Text="{Binding Label}"
                                         Background="#AA000000"
                                         Foreground="#00FF00"
                                         Padding="5,2"
                                         VerticalAlignment="Top"
                                         HorizontalAlignment="Left"/>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- No Camera Message -->
                <Border Visibility="{Binding NoCameraVisibility}"
                      Background="#33000000"
                      CornerRadius="10"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Padding="40">
                    <StackPanel>
                        <TextBlock Text="ðŸ“·"
                                 FontSize="64"
                                 HorizontalAlignment="Center"
                                 Margin="0,0,0,20"/>
                        <TextBlock Text="No Camera Connected"
                                 FontSize="24"
                                 FontWeight="Bold"
                                 Foreground="White"
                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="Please connect a camera or select Moxie's view"
                                 FontSize="14"
                                 Foreground="#AAAAAA"
                                 HorizontalAlignment="Center"
                                 Margin="0,10,0,0"/>
                        <Button Content="Refresh Cameras"
                              Command="{Binding RefreshCamerasCommand}"
                              HorizontalAlignment="Center"
                              Margin="0,20,0,0"
                              Padding="20,10"/>
                    </StackPanel>
                </Border>

                <!-- Recording Indicator -->
                <Border Visibility="{Binding RecordingVisibility}"
                      Background="#AAFF0000"
                      CornerRadius="5"
                      HorizontalAlignment="Left"
                      VerticalAlignment="Top"
                      Margin="20"
                      Padding="10,5">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8"
                               Height="8"
                               Fill="White"
                               Margin="0,0,8,0">
                            <Ellipse.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard Storyboard="{StaticResource RecordingPulse}"/>
                                </EventTrigger>
                            </Ellipse.Triggers>
                        </Ellipse>
                        <TextBlock Text="REC"
                                 Foreground="White"
                                 FontWeight="Bold"/>
                        <TextBlock Text="{Binding RecordingDuration}"
                                 Foreground="White"
                                 Margin="10,0,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Bottom Control Panel -->
            <Border Grid.Row="2"
                    Background="#1A1A1A"
                    BorderBrush="#333333"
                    BorderThickness="0,1,0,0">
                <Grid Height="120">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Camera Controls -->
                    <StackPanel Grid.Column="0"
                              Orientation="Horizontal"
                              HorizontalAlignment="Left"
                              VerticalAlignment="Center"
                              Margin="20,0">

                        <!-- Zoom Controls -->
                        <StackPanel Margin="0,0,30,0">
                            <TextBlock Text="Zoom"
                                     Foreground="#AAAAAA"
                                     FontSize="12"
                                     HorizontalAlignment="Center"
                                     Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="âˆ’"
                                      Command="{Binding ZoomOutCommand}"
                                      Width="30"
                                      Height="30"/>
                                <TextBlock Text="{Binding ZoomLevel, StringFormat='{}{0}%'}"
                                         Width="50"
                                         TextAlignment="Center"
                                         VerticalAlignment="Center"
                                         Foreground="White"/>
                                <Button Content="+"
                                      Command="{Binding ZoomInCommand}"
                                      Width="30"
                                      Height="30"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Brightness Control -->
                        <StackPanel Margin="0,0,30,0">
                            <TextBlock Text="Brightness"
                                     Foreground="#AAAAAA"
                                     FontSize="12"
                                     HorizontalAlignment="Center"
                                     Margin="0,0,0,5"/>
                            <Slider Value="{Binding Brightness}"
                                  Width="100"
                                  Minimum="-100"
                                  Maximum="100"
                                  TickFrequency="25"/>
                        </StackPanel>

                        <!-- Contrast Control -->
                        <StackPanel>
                            <TextBlock Text="Contrast"
                                     Foreground="#AAAAAA"
                                     FontSize="12"
                                     HorizontalAlignment="Center"
                                     Margin="0,0,0,5"/>
                            <Slider Value="{Binding Contrast}"
                                  Width="100"
                                  Minimum="-100"
                                  Maximum="100"
                                  TickFrequency="25"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Main Controls -->
                    <StackPanel Grid.Column="1"
                              Orientation="Horizontal"
                              VerticalAlignment="Center">

                        <Button Width="60"
                              Height="60"
                              Margin="10,0"
                              Command="{Binding TakeSnapshotCommand}"
                              ToolTip="Take Snapshot">
                            <TextBlock Text="ðŸ“¸" FontSize="24"/>
                        </Button>

                        <ToggleButton Width="80"
                                    Height="80"
                                    IsChecked="{Binding IsRecording}"
                                    Command="{Binding ToggleRecordingCommand}"
                                    ToolTip="Record Video">
                            <ToggleButton.Style>
                                <Style TargetType="ToggleButton">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Grid>
                                                    <Ellipse Fill="{TemplateBinding Background}"
                                                           Stroke="#666666"
                                                           StrokeThickness="2"/>
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"/>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsChecked" Value="False">
                                            <Setter Property="Background" Value="#CC0000"/>
                                            <Setter Property="Content">
                                                <Setter.Value>
                                                    <Ellipse Width="30" Height="30" Fill="White"/>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                        <Trigger Property="IsChecked" Value="True">
                                            <Setter Property="Background" Value="#FF0000"/>
                                            <Setter Property="Content">
                                                <Setter.Value>
                                                    <Rectangle Width="25" Height="25" Fill="White"/>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ToggleButton.Style>
                        </ToggleButton>

                        <Button Width="60"
                              Height="60"
                              Margin="10,0"
                              Command="{Binding OpenSettingsCommand}"
                              ToolTip="Camera Settings">
                            <TextBlock Text="âš™ï¸" FontSize="24"/>
                        </Button>
                    </StackPanel>

                    <!-- Info Panel -->
                    <StackPanel Grid.Column="2"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Center"
                              Margin="20,0">
                        <TextBlock Text="{Binding Resolution}"
                                 Foreground="#AAAAAA"
                                 FontSize="12"/>
                        <TextBlock Text="{Binding FrameRate}"
                                 Foreground="#AAAAAA"
                                 FontSize="12"
                                 Margin="0,2,0,0"/>
                        <TextBlock Text="{Binding Format}"
                                 Foreground="#AAAAAA"
                                 FontSize="12"
                                 Margin="0,2,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Settings Overlay -->
        <Border x:Name="SettingsOverlay"
              Visibility="{Binding SettingsVisibility}"
              Background="#DD000000">
            <Border Background="#2A2A2A"
                  CornerRadius="10"
                  Width="400"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  Padding="20">
                <StackPanel>
                    <TextBlock Text="Camera Settings"
                             FontSize="20"
                             FontWeight="Bold"
                             Foreground="White"
                             Margin="0,0,0,20"/>

                    <!-- Resolution -->
                    <TextBlock Text="Resolution"
                             Foreground="White"
                             Margin="0,0,0,5"/>
                    <ComboBox SelectedItem="{Binding SelectedResolution}"
                            ItemsSource="{Binding AvailableResolutions}"
                            Margin="0,0,0,15"/>

                    <!-- Frame Rate -->
                    <TextBlock Text="Frame Rate"
                             Foreground="White"
                             Margin="0,0,0,5"/>
                    <ComboBox SelectedItem="{Binding SelectedFrameRate}"
                            ItemsSource="{Binding AvailableFrameRates}"
                            Margin="0,0,0,15"/>

                    <!-- Video Format -->
                    <TextBlock Text="Video Format"
                             Foreground="White"
                             Margin="0,0,0,5"/>
                    <ComboBox SelectedItem="{Binding SelectedFormat}"
                            ItemsSource="{Binding AvailableFormats}"
                            Margin="0,0,0,15"/>

                    <!-- Auto-Exposure -->
                    <CheckBox Content="Auto Exposure"
                            IsChecked="{Binding AutoExposure}"
                            Foreground="White"
                            Margin="0,0,0,10"/>

                    <!-- Auto-Focus -->
                    <CheckBox Content="Auto Focus"
                            IsChecked="{Binding AutoFocus}"
                            Foreground="White"
                            Margin="0,0,0,20"/>

                    <!-- Buttons -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                              Content="Cancel"
                              Command="{Binding CancelSettingsCommand}"
                              Margin="0,0,5,0"/>

                        <Button Grid.Column="1"
                              Content="Apply"
                              Command="{Binding ApplySettingsCommand}"
                              Margin="5,0,0,0"
                              Background="#00CED1"/>
                    </Grid>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</UserControl>